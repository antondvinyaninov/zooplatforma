# Галерея медиа в профиле

## Описание

Все фото и видео, которые пользователь загружает в метках (постах), автоматически сохраняются в его личном облаке и отображаются в профиле.

## Функциональность

### 1. Вкладки в профиле

- **Публикации** - все посты пользователя
- **Фотографии** - галерея всех загруженных фото
- **Видео** - галерея всех загруженных видео

### 2. Галерея медиа

**Компонент:** `MediaGallery.tsx`

**Возможности:**
- Отображение медиа в виде сетки 3x3
- Фильтры: Все / Фото / Видео
- Счетчики количества файлов
- Превью видео с иконкой воспроизведения
- Информация о файле при наведении (название, размер)
- Lightbox для просмотра в полном размере
- Навигация между файлами

**Пример использования:**
```tsx
<MediaGallery userId={userId} mediaType="photo" />
<MediaGallery userId={userId} mediaType="video" />
<MediaGallery userId={userId} mediaType="all" />
```

### 3. Статистика медиа

**Компонент:** `MediaStats.tsx`

**Отображает:**
- Количество фотографий
- Количество видео
- Количество документов (если есть)
- Общий размер всех файлов
- Общее количество файлов

**Показывается только:** в своем профиле

## API Endpoints

### GET /api/media/user/:userId

Получить все медиа пользователя

**Query параметры:**
- `type` (optional) - фильтр по типу: `photo`, `video`, `document`

**Пример:**
```
GET /api/media/user/1
GET /api/media/user/1?type=photo
GET /api/media/user/1?type=video
```

**Ответ:**
```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "user_id": 1,
      "file_name": "uuid.jpg",
      "original_name": "photo.jpg",
      "file_path": "users/1/photos/2025/12/uuid.jpg",
      "file_size": 1024000,
      "mime_type": "image/jpeg",
      "media_type": "photo",
      "width": 1920,
      "height": 1080,
      "uploaded_at": "2025-12-28T10:00:00Z",
      "url": "/api/media/file/1"
    }
  ]
}
```

### GET /api/media/stats

Получить статистику медиа текущего пользователя

**Требует:** авторизацию

**Ответ:**
```json
{
  "success": true,
  "data": {
    "total_files": 25,
    "total_size": 52428800,
    "photos_count": 20,
    "videos_count": 5,
    "docs_count": 0
  }
}
```

## Структура хранения

```
uploads/
└── users/
    └── {user_id}/
        ├── photos/
        │   └── {year}/
        │       └── {month}/
        │           └── {uuid}.jpg
        └── videos/
            └── {year}/
                └── {month}/
                    └── {uuid}_optimized.mp4
```

## База данных

**Таблица:** `user_media`

**Поля:**
- `id` - ID медиа
- `user_id` - ID пользователя
- `file_name` - Имя файла (UUID)
- `original_name` - Оригинальное имя
- `file_path` - Относительный путь
- `file_size` - Размер в байтах
- `mime_type` - MIME тип
- `media_type` - Тип: photo, video, document
- `width`, `height` - Размеры (для фото)
- `duration` - Длительность (для видео)
- `uploaded_at` - Дата загрузки

## UX особенности

1. **Автоматическое сохранение** - все медиа из постов автоматически попадают в галерею
2. **Личное облако** - пользователь может просматривать все свои файлы в одном месте
3. **Быстрый доступ** - вкладки для быстрого переключения между типами медиа
4. **Статистика** - видно сколько места занимают файлы
5. **Lightbox** - удобный просмотр в полном размере

## Будущие улучшения

- [ ] Удаление медиа из галереи
- [ ] Скачивание файлов
- [ ] Альбомы и коллекции
- [ ] Поиск по медиа
- [ ] Сортировка (по дате, размеру, типу)
- [ ] Массовые операции (выбрать несколько файлов)
- [ ] Лимиты хранилища
- [ ] Предупреждение при приближении к лимиту

