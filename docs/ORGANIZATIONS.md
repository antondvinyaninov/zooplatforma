# Система организаций

## Обзор

Система профилей организаций позволяет создавать и управлять страницами приютов, ветклиник, зоомагазинов, фондов и других организаций, связанных с животными.

## Типы организаций

1. **Приют для животных** (`shelter`)
   - Размещение животных, ищущих дом
   - Информация о волонтерстве
   - Сбор пожертвований

2. **Ветеринарная клиника** (`vet_clinic`)
   - Услуги и цены
   - Расписание работы
   - Контакты врачей

3. **Зоомагазин** (`pet_shop`)
   - Каталог товаров
   - Акции и скидки
   - Доставка

4. **Фонд помощи животным** (`foundation`)
   - Программы помощи
   - Отчеты о деятельности
   - Сбор средств

5. **Кинологический центр** (`kennel`)
   - Дрессировка
   - Выставки
   - Племенное разведение

6. **Другое** (`other`)
   - Любые другие организации

## Структура профиля

### Основная информация
- Название организации
- Краткое название
- Тип организации
- Описание деятельности
- Логотип и обложка

### Юридическая информация
- ИНН (10 или 12 цифр)
- ОГРН (13 или 15 цифр)
- КПП (9 цифр)
- Организационно-правовая форма (ООО, ИП, АНО, Фонд)
- Дата регистрации

### Контакты
- Телефон
- Email
- Сайт
- Полный адрес
- Координаты (для карты)

### Руководство
- ФИО руководителя
- Должность

### Команда
- Владелец (owner) - создатель профиля
- Администраторы (admin) - полные права
- Модераторы (moderator) - могут создавать посты
- Участники (member) - базовые права

## Права доступа

### Роли участников

| Роль | Создание постов | Редактирование профиля | Управление участниками |
|------|----------------|----------------------|----------------------|
| Owner | ✅ | ✅ | ✅ |
| Admin | ✅ | ✅ | ✅ |
| Moderator | ✅ | ❌ | ❌ |
| Member | ❌ | ❌ | ❌ |

### Настройки приватности
- Видимость профиля (public/private)
- Видимость телефона (everyone/nobody)
- Видимость email (everyone/nobody)
- Личные сообщения (everyone/nobody)

## API Endpoints

### Организации
- `POST /api/organizations` - Создать организацию
- `GET /api/organizations/:id` - Получить организацию
- `PUT /api/organizations/:id` - Обновить организацию
- `DELETE /api/organizations/:id` - Удалить организацию
- `GET /api/organizations/user/:userId` - Организации пользователя

### Участники
- `GET /api/organizations/:id/members` - Список участников
- `POST /api/organizations/:id/members` - Добавить участника
- `PUT /api/organizations/:id/members/:memberId` - Обновить участника
- `DELETE /api/organizations/:id/members/:memberId` - Удалить участника

### Медиа
- `POST /api/organizations/:id/logo` - Загрузить логотип
- `POST /api/organizations/:id/cover` - Загрузить обложку

## Интеграции

### DaData API
Автоматическое заполнение данных организации по ИНН:
- Полное название
- Юридический адрес
- ОГРН, КПП
- ФИО руководителя
- Дата регистрации

### Яндекс.Карты
Отображение местоположения организации на карте:
- Геокодирование адреса
- Интерактивная карта
- Маршруты до организации

## Страницы

### Профиль организации
**URL:** `/org/[id]`

**Структура:**
- Обложка с логотипом
- Основная информация
- Описание деятельности
- Контакты
- Команда
- Публикации
- Питомцы организации

**Layout:** 3 колонки (как у профиля пользователя)
- Левая колонка (2/3): основной контент
- Правая колонка (1/3): информация и действия

### Создание организации
**URL:** `/org/create` (TODO)

**Форма:**
1. Основная информация
2. Юридические данные (с автозаполнением по ИНН)
3. Контакты
4. Адрес (с картой)
5. Описание

### Редактирование организации
**URL:** `/org/[id]/edit` (TODO)

**Разделы:**
- Профиль
- Контакты
- Команда
- Настройки

## База данных

### Таблица `organizations`
37 полей, включая:
- Основную информацию
- Юридические данные
- Контакты и адрес
- Координаты
- Медиа
- Настройки приватности
- Статус верификации

### Таблица `organization_members`
Связь пользователей с организациями:
- Роль (owner, admin, moderator, member)
- Должность
- Права доступа
- Дата присоединения

### Таблица `organization_pets`
Связь питомцев с организациями:
- ID организации
- ID питомца
- Дата добавления
- Заметки

## Примеры использования

### Приют для животных
```typescript
{
  name: "Приют 'Дай лапу'",
  type: "shelter",
  description: "Помогаем бездомным животным найти дом",
  address_city: "Москва",
  phone: "+7 (495) 123-45-67",
  email: "info@daylаpu.ru"
}
```

### Ветеринарная клиника
```typescript
{
  name: "Ветклиника 'Айболит'",
  type: "vet_clinic",
  description: "Полный спектр ветеринарных услуг",
  address_full: "г. Москва, ул. Ленина, д. 10",
  phone: "+7 (495) 987-65-43",
  website: "https://aibolit.ru"
}
```

## TODO

### Ближайшие задачи
- [ ] Страница создания организации
- [ ] Страница редактирования организации
- [ ] Загрузка логотипа и обложки
- [ ] Интеграция с DaData для автозаполнения
- [ ] Яндекс.Карта на странице организации
- [ ] Посты от имени организации
- [ ] Список питомцев организации
- [ ] Поиск организаций по городу/типу
- [ ] **Система верификации организаций**

### Будущие функции
- [ ] Рейтинг и отзывы
- [ ] Расписание работы
- [ ] Онлайн-запись (для ветклиник)
- [ ] Каталог товаров (для зоомагазинов)
- [ ] Программы волонтерства (для приютов)
- [ ] Отчеты о деятельности (для фондов)
- [ ] Статистика посещений
- [ ] Интеграция с соцсетями

## Система верификации организаций

### Текущий статус
Поле `is_verified` существует в базе данных, но механизм верификации еще не реализован. Галочка верификации отображается на карточках организаций, но получить её пока нельзя.

### Планируемый процесс верификации

#### 1. Подача заявки
Владелец организации может запросить верификацию:
- Кнопка "Запросить верификацию" в настройках организации
- Форма с загрузкой документов:
  - ИНН организации (обязательно)
  - ОГРН для юрлиц (обязательно)
  - Скан документа о регистрации (PDF/JPG)
  - Контактные данные для связи
  - Комментарий (опционально)

#### 2. Автоматическая проверка
Система автоматически проверяет данные через DaData API:
- Существование организации в ЕГРЮЛ/ЕГРИП
- Соответствие ИНН и ОГРН
- Статус организации (действующая/ликвидирована)
- Совпадение названия и адреса

#### 3. Модерация
Администратор платформы проверяет заявку:
- Просматривает загруженные документы
- Сверяет данные с профилем организации
- Проверяет реальность деятельности (сайт, соцсети)
- Принимает решение: одобрить или отклонить

#### 4. Результат
- **Одобрено:** организация получает галочку верификации (CheckBadgeIcon)
- **Отклонено:** владелец получает уведомление с причиной отказа
- Возможность повторной подачи заявки через 30 дней

### Преимущества верификации
- ✅ Повышенное доверие пользователей
- ✅ Приоритет в поиске и рекомендациях
- ✅ Возможность размещать объявления о животных от имени организации
- ✅ Доступ к расширенной статистике
- ✅ Специальный значок на профиле и в списках

### Требования для верификации
- Организация должна быть зарегистрирована официально (ИНН/ОГРН)
- Профиль должен быть заполнен минимум на 80%
- Наличие контактных данных (телефон, email)
- Реальная деятельность в сфере помощи животным

### Технические детали

#### База данных
Новая таблица `organization_verification_requests`:
```sql
CREATE TABLE organization_verification_requests (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    organization_id INTEGER NOT NULL,
    status TEXT DEFAULT 'pending', -- pending, approved, rejected
    inn TEXT NOT NULL,
    ogrn TEXT,
    documents TEXT, -- JSON массив путей к файлам
    comment TEXT,
    admin_comment TEXT,
    admin_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (organization_id) REFERENCES organizations(id),
    FOREIGN KEY (admin_id) REFERENCES users(id)
);
```

#### API Endpoints
- `POST /api/organizations/:id/verification` - Подать заявку
- `GET /api/organizations/:id/verification` - Статус заявки
- `GET /api/admin/verifications` - Список заявок (админ)
- `PUT /api/admin/verifications/:id` - Одобрить/отклонить (админ)

### TODO
- [ ] Создать таблицу `organization_verification_requests`
- [ ] API для подачи заявки на верификацию
- [ ] Форма загрузки документов
- [ ] Админ-панель для модерации заявок
- [ ] Интеграция с DaData для автоматической проверки ИНН/ОГРН
- [ ] Уведомления о статусе заявки (email + in-app)
- [ ] История верификаций в профиле организации
- [ ] Возможность отозвать верификацию (для админов)

---

**Дата создания:** 2024-12-29  
**Последнее обновление:** 2024-12-29  
**Статус:** Базовая версия готова
