# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∏–¥–µ–æ

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ FFmpeg

### macOS
```bash
brew install ffmpeg
```

### Linux (Ubuntu/Debian)
```bash
sudo apt update
sudo apt install ffmpeg
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
```bash
ffmpeg -version
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –Ω–æ —Å–∂–∏–º–∞–µ–º)

1. **–§–æ—Ä–º–∞—Ç:** MP4 (H.264 + AAC)
2. **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ:** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ (FullHD ‚Üí FullHD, 720p ‚Üí 720p)
3. **CRF:** 28 (–∫–∞—á–µ—Å—Ç–≤–æ, –≤—ã—à–µ = –±–æ–ª—å—à–µ —Å–∂–∞—Ç–∏–µ)
4. **–ë–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ:** 64k (—Å—Ç–µ—Ä–µ–æ)
5. **FPS:** –º–∞–∫—Å–∏–º—É–º 30
6. **Preset:** medium (–±–∞–ª–∞–Ω—Å —Å–∫–æ—Ä–æ—Å—Ç—å/–∫–∞—á–µ—Å—Ç–≤–æ)
7. **Profile:** main, Level 4.0 (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π)

### –ü—Ä–∏–º–µ—Ä—ã —Å–∂–∞—Ç–∏—è

**FullHD –≤–∏–¥–µ–æ:** 50MB, 1920x1080 ‚Üí ~5-8MB, 1920x1080 (—ç–∫–æ–Ω–æ–º–∏—è 85-90%)
**720p –≤–∏–¥–µ–æ:** 20MB, 1280x720 ‚Üí ~2-3MB, 1280x720 (—ç–∫–æ–Ω–æ–º–∏—è 85-90%)
**4K –≤–∏–¥–µ–æ:** 100MB, 3840x2160 ‚Üí ~10-15MB, 3840x2160 (—ç–∫–æ–Ω–æ–º–∏—è 85-90%)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞, –Ω–æ —Å–∂–∏–º–∞–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞!

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### Chunked Upload + –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —á–∞—Å—Ç—è–º (Chunked Upload)**
   - –í–∏–¥–µ–æ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á–∞—Å—Ç–∏ –ø–æ 5MB
   - –ö–∞–∂–¥–∞—è —á–∞—Å—Ç—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å: "–ó–∞–≥—Ä—É–∑–∫–∞ 3/10 —á–∞—Å—Ç–µ–π"
   - –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö —á–∞—Å—Ç–µ–π —Ñ–∞–π–ª —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

2. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ**
   - –°–æ–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤–∏–¥–µ–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
   - API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `optimizing: true` —Ñ–ª–∞–≥

3. **–§–æ–Ω–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (goroutine)**
   - FFprobe –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–µ–æ
   - FFmpeg –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∏–¥–µ–æ –≤ —Ñ–æ–Ω–µ:
     - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ MP4
     - **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ**
     - –ü—Ä–∏–º–µ–Ω—è–µ—Ç CRF 28 –¥–ª—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ —Å–∂–∞—Ç–∏—è
     - –°–Ω–∏–∂–∞–µ—Ç –±–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ –¥–æ 64k
     - –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç FPS –¥–æ 30
     - –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –¥–ª—è –≤–µ–±-–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
   - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
   - –û—Ä–∏–≥–∏–Ω–∞–ª –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π

4. **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**
   - ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∂–¥–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
   - ‚úÖ –í–∏–¥–µ–æ –¥–æ—Å—Ç—É–ø–Ω–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
   - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
   - ‚úÖ –≠–∫–æ–Ω–æ–º–∏—è 50-90% —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞

## –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ (Chunked Upload)
- **10MB –≤–∏–¥–µ–æ:** ~2-3 —Å–µ–∫—É–Ω–¥—ã (2 —á–∞—Å—Ç–∏)
- **50MB –≤–∏–¥–µ–æ:** ~8-10 —Å–µ–∫—É–Ω–¥ (10 —á–∞—Å—Ç–µ–π)
- **100MB –≤–∏–¥–µ–æ:** ~15-20 —Å–µ–∫—É–Ω–¥ (20 —á–∞—Å—Ç–µ–π)

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –≤–∏–¥–µ–æ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏!**

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–≤ —Ñ–æ–Ω–µ)
- **10 —Å–µ–∫—É–Ω–¥ –≤–∏–¥–µ–æ:** ~3-5 —Å–µ–∫—É–Ω–¥
- **1 –º–∏–Ω—É—Ç–∞ –≤–∏–¥–µ–æ:** ~15-20 —Å–µ–∫—É–Ω–¥
- **5 –º–∏–Ω—É—Ç –≤–∏–¥–µ–æ:** ~60-90 —Å–µ–∫—É–Ω–¥

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!**

## –ö–æ–º–∞–Ω–¥–∞ FFmpeg

```bash
# –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
ffprobe -v error -select_streams v:0 -show_entries stream=width,height -of csv=p=0 input.mp4

# –ó–∞—Ç–µ–º —Å–∂–∏–º–∞–µ–º —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
ffmpeg -i input.mp4 \
  -c:v libx264 \
  -preset medium \
  -crf 28 \
  -profile:v main \
  -level 4.0 \
  -pix_fmt yuv420p \
  -r 30 \
  -c:a aac \
  -b:a 64k \
  -ar 44100 \
  -ac 2 \
  -movflags +faststart \
  -y output.mp4
```

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- **–ë–ï–ó `-vf scale`** - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ!
- `-c:v libx264` - –∫–æ–¥–µ–∫ H.264
- `-preset medium` - —Å—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏, –ª—É—á—à–µ–µ —Å–∂–∞—Ç–∏–µ
- `-crf 28` - –∫–∞—á–µ—Å—Ç–≤–æ (18-28, –≤—ã—à–µ = –±–æ–ª—å—à–µ —Å–∂–∞—Ç–∏–µ, Telegram ~28)
- `-profile:v main` - –ø—Ä–æ—Ñ–∏–ª—å H.264 –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `-level 4.0` - —É—Ä–æ–≤–µ–Ω—å H.264 (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ FullHD –∏ –≤—ã—à–µ)
- `-pix_fmt yuv420p` - —Ñ–æ—Ä–º–∞—Ç –ø–∏–∫—Å–µ–ª–µ–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- `-r 30` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ FPS –¥–æ 30
- `-c:a aac` - –∫–æ–¥–µ–∫ –∞—É–¥–∏–æ AAC
- `-b:a 64k` - –±–∏—Ç—Ä–µ–π—Ç –∞—É–¥–∏–æ 64 kbps (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
- `-ar 44100` - —á–∞—Å—Ç–æ—Ç–∞ –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏
- `-ac 2` - —Å—Ç–µ—Ä–µ–æ
- `-movflags +faststart` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤–µ–± (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ)

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):

```go
// –í media.go
const OptimizeVideo = false // –û—Ç–∫–ª—é—á–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Chunked Upload –ª–æ–≥–∏:
```
üì§ [CHUNKED] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏: upload_id=xxx, user_id=1, file=video.mp4, size=55MB, chunks=12
üì¶ [CHUNKED] Chunk –∑–∞–≥—Ä—É–∂–µ–Ω: upload_id=xxx, chunk=0, size=5242880
üì¶ [CHUNKED] Chunk –∑–∞–≥—Ä—É–∂–µ–Ω: upload_id=xxx, chunk=1, size=5242880
...
üîó [CHUNKED] –°–±–æ—Ä–∫–∞ —Ñ–∞–π–ª–∞: upload_id=xxx, chunks=12
‚úÖ [CHUNKED] –§–∞–π–ª —Å–æ–±—Ä–∞–Ω: /path/to/video.mp4, size=55MB
üíæ [CHUNKED] –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –ë–î: ID=29
üéâ [CHUNKED] –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ID=29 (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤ —Ñ–æ–Ω–µ)
```

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏:
```
üé¨ [ASYNC] –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ñ–æ–Ω–æ–≤–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è ID=29
üìê [VIDEO] –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: 1920,1080
‚öôÔ∏è [VIDEO] FFmpeg –∫–æ–º–∞–Ω–¥–∞: ffmpeg -i input.mp4 ...
‚úÖ [ASYNC] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –¥–ª—è ID=29, –Ω–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä: 28MB
üìä [VIDEO] –≠–∫–æ–Ω–æ–º–∏—è: 49% (27MB)
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–º—è (–ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –¢—Ä–µ–±—É–µ—Ç FFmpeg –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CPU (–º–æ–∂–µ—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–∫–∞—Ö)

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

1. **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è** - —Å–∂–∏–º–∞—Ç—å –Ω–∞ frontend (WebAssembly FFmpeg)
2. **–û–±–ª–∞—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AWS MediaConvert, Cloudinary
3. **–û—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á** - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–∏–¥–µ–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
