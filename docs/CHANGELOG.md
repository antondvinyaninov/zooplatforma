# Changelog

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и этот проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

<!-- 
ПРАВИЛО: В секции "Технологии" указывать ТОЛЬКО новые или измененные технологии.
НЕ перечислять весь стек проекта в каждой версии!

✅ Правильно:
### Технологии
- Добавлено: DaData API для поиска организаций
- Обновлено: React 18 → 19

❌ Неправильно:
### Технологии
- Go 1.25.5
- Node.js 25.2.0
- Next.js 16.0.8
- (весь стек проекта)

Полный стек технологий находится в README.md
Подробные правила: ../.kiro/steering/changelog-rules.md
-->

## [Unreleased]

## [0.1.3] - 2025-12-14

### Fixed
- **Критическое исправление:** Tailwind CSS v4 не применял стили к компонентам из @pet/shared
- Исправлены пути к database модулю после реструктуризации проекта
- `main/backend/go.mod`: путь к database изменен с `../database` на `../../database`
- `database/db.go`: путь к БД изменен на `../../database/data.db` для корректной работы из `main/backend`
- Компоненты с Tailwind классами теперь копируются напрямую в каждый сервис
- AuthForm скопирован в main/frontend и admin/frontend
- Страница авторизации админки теперь отображается корректно
- Backend сервисы теперь запускаются без ошибок после переноса в папки main/ и admin/

### Changed
- Обновлена архитектура работы с shared компонентами
- Tailwind config очищен от неработающих путей к node_modules
- Компоненты импортируются локально вместо @pet/shared

### Added
- Документация `shared/README.md` с объяснением проблемы Tailwind v4
- Steering правило `.kiro/steering/shared-components.md` для работы с shared компонентами
- Инструкции по копированию компонентов между сервисами

### Technical Details
- Tailwind CSS v4 не сканирует файлы из node_modules по умолчанию
- Решение: копирование компонентов вместо импорта из пакета
- TypeScript типы, API клиенты и хуки можно импортировать из @pet/shared
- React компоненты с Tailwind классами нужно копировать
- После реструктуризации проекта все относительные пути обновлены

## [0.1.2] - 2025-12-12

### Added
- **Полноценная система комментариев** к постам
- Таблица `comments` в базе данных с поддержкой вложенности
- Вложенные комментарии (1 уровень, как в ВК)
- Кнопка "Ответить" под каждым комментарием
- Упоминание пользователя синим цветом при ответе (@Имя)
- Индикатор "Ответ для [Имя]" при написании ответа
- Кнопка отмены ответа
- Удаление комментариев (только автор)
- Форматирование времени комментариев ("только что", "5 мин назад")
- Счетчик комментариев обновляется в реальном времени
- Кнопка "Показать/Скрыть комментарии"
- Поля `parent_id` и `reply_to_user_id` в таблице comments
- Модель `Comment` с поддержкой вложенности и ответов
- API endpoints для комментариев (GET, POST, DELETE)
- Компонент `PostComments` с полным функционалом
- Callback `onCountChange` для обновления счетчика в родительском компоненте

### Changed
- Отказ от концепции "стены" в пользу комментариев
- Лента теперь использует комментарии вместо записей на стене
- Профиль пользователя показывает только его посты с комментариями
- Счетчик комментариев теперь динамический (обновляется без перезагрузки)
- Backend возвращает дерево комментариев (корневые + replies)
- Страница редактирования профиля вынесена на отдельный URL `/profile/edit`

### Fixed
- Адаптивность главной страницы на маленьких экранах
- Feed теперь занимает 100% ширины на мобильных устройствах
- Header адаптирован для мобильных (скрыт CityDetector, сокращен placeholder)
- Профиль пользователя адаптирован (обложка, аватар, кнопки)
- Табы в профиле адаптивны (overflow-x-auto)
- Layout уменьшен padding на маленьких экранах

### Removed
- Удалена концепция "стены" (записи на чужих профилях)
- Удален компонент `WriteOnWall`
- Удален handler `WallPostHandler`
- Удалено поле `wall_author_id` из таблицы posts

## [0.1.1] - 2025-12-12

### Fixed
- **Критическое исправление:** Авторизация при создании постов теперь работает корректно
- Middleware теперь извлекает `userID` из JWT токена и добавляет его в контекст запроса
- Handler создания постов теперь получает `userID` из контекста
- Исправлено "мигание" кнопки "Войти" при обновлении страницы
- Добавлен skeleton loader во время проверки авторизации
- UserMenu теперь проверяет флаг `isLoading` перед отображением

### Changed
- AuthMiddleware теперь парсит claims из JWT и добавляет `userID` в `context.Context`
- UserMenu показывает placeholder (серый кружок) во время загрузки состояния авторизации

## [0.1.0] - 2025-12-12

### Added
- **Админ-панель (Frontend)** на Next.js
- Страница входа в админ-панель (`/auth`) с формой авторизации
- Дашборд с вкладками: Пользователи, Посты, Статистика, Логирование
- Сворачиваемое боковое меню с иконками Heroicons
- Таблицы с данными пользователей и постов
- Модерация постов (одобрение/отклонение/удаление)
- Управление пользователями (просмотр/удаление)
- Статистика платформы (пользователи, посты, активность)
- **Система логирования** для всей платформы
- Таблица `system_logs` для хранения всех событий системы
- Вкладка "Логирование" в админ-панели с отображением всех логов
- Автоматическое логирование входа пользователей
- Функция `logSystemEvent()` для логирования событий
- Уровни логов: info, warning, error, debug
- Категории логов: auth, user, post, pet, profile, admin, system, security
- Цветные бейджи для разных типов действий в логах
- Air (hot reload) для Admin Backend
- Tailwind CSS в админ-панели
- Heroicons для всех иконок в админ-панели

### Changed
- Admin Backend теперь запускается с Air для hot reload
- Порт Admin Frontend: 4000 (вместо "в разработке")
- Серый фон у сайдбара, белый у основного контента (инверсия)
- Активный пункт меню выделяется белым фоном с тенью
- Боковое меню теперь широкое (200px) с текстом и иконками
- Кнопка сворачивания меню перенесена вниз
- SQL запросы в Admin Backend адаптированы под SQLite (вместо PostgreSQL)
- Обработка NULL значений в SQL запросах через `sql.NullString`
- Endpoint `/api/admin/stats` переименован в `/api/admin/stats/overview`
- Цвет текста на главном сайте зафиксирован (#171717) независимо от темной темы

### Fixed
- Исправлена проблема со светлым текстом при вводе на главном сайте
- Исправлены SQL placeholder'ы ($1, $2 → ?) для SQLite
- Исправлена обработка пустых массивов в API логов
- Исправлена структура интерфейса Log (добавлено поле admin_name)

### Технологии
- Добавлено: Tailwind CSS 4.x в админ-панели
- Добавлено: Heroicons 2.x в админ-панели
- Добавлено: Air для Admin Backend

## [0.0.9] - 2025-12-12

### Added
- **SSO (Single Sign-On)** архитектура для всех микросервисов
- Поле `roles` в JWT токенах для управления правами доступа
- Поля `exp` и `iat` в JWT токенах
- Endpoint `/api/auth/verify` для проверки токенов микросервисами
- Функция `getUserRoles()` для получения ролей пользователя из таблицы admins
- Микросервис админ-панели в папке `admin/`
- Backend для админ-панели (Go, порт 8081)
- Таблицы `admins` и `admin_logs` в базе данных
- Middleware для проверки прав суперадмина (с поддержкой SSO)
- API endpoints для управления пользователями
- API endpoints для модерации постов
- API endpoints для статистики
- API endpoints для просмотра логов
- Скрипт `create-superadmin.sh` для назначения первого суперадмина
- Скрипт `tests/debug-sso.sh` для отладки SSO
- Документ `docs/SSO_ARCHITECTURE.md` с архитектурой SSO системы
- Документ `docs/SSO_FLOW.md` с визуальной схемой SSO
- Документ `admin/SSO_SETUP.md` с инструкцией по настройке
- Документ `admin/IMPLEMENTATION_STATUS.md` со статусом реализации
- Логирование всех действий администраторов

### Changed
- JWT токены теперь включают массив `roles` для определения прав доступа
- Cookie `auth_token` теперь общий для всех микросервисов (SSO)
- Admin Backend использует общий токен `auth_token` вместо `admin_token`
- Middleware в Admin Backend проверяет роли из JWT вместо отдельной авторизации
- Функция `GenerateToken()` теперь принимает параметр `roles` и добавляет `exp`, `iat`
- Функция `ParseToken()` теперь возвращает `Roles` в структуре `TokenClaims`
- Скрипт `run` теперь запускает все сервисы включая Admin Backend
- Mobile порт изменен с 8081 на 8082 (8081 используется Admin Backend)
- Функция `InitDB()` теперь имеет вариант `InitDBWithPath()` для гибкости путей

### Removed
- Отдельная авторизация для админ-панели (заменена на SSO)

### Fixed
- Исправлены HTTP method константы в admin handlers (MethodGet вместо MethodGET)
- **Исправлена критическая ошибка:** JWT Secret теперь инициализируется ПОСЛЕ загрузки .env файла
- Исправлена валидация JWT токенов в Admin Backend
- Исправлены порты: Mobile (8081), Admin Backend (9000) для избежания конфликтов

## [0.0.8] - 2025-12-12

### Added
- Файл `.kiro/steering/changelog-rules.md` с правилами ведения CHANGELOG
- Комментарий-напоминание о правилах в начале CHANGELOG.md
- Правило: в секции "Технологии" указывать только новые/измененные технологии
- Папка `docs/` для всей документации проекта
- Файл `docs/README.md` с описанием всей документации
- Файл `docs/ROADMAP.md` с планом развития проекта и критериями версионирования
- Файл `docs/PERFORMANCE.md` с метриками производительности и рекомендациями
- Файл `docs/STRUCTURE.md` с описанием архитектуры проекта
- Файл `docs/TEMPLATES.md` с шаблонами страниц и компонентов
- Файл `docs/API_KEYS.md` с конфиденциальной информацией (не в git)
- Папка `tests/` для всех тестов проекта
- Скрипт `tests/performance-test.sh` для автоматического тестирования скорости
- Скрипт `tests/compare-with-vk.sh` для сравнения с VK.com
- Скрипт `tests/web-vitals-test.sh` для измерения Web Vitals через Lighthouse
- Файл `tests/README.md` с документацией по тестам
- Сравнительный анализ производительности с VK.com
- Целевые показатели Web Vitals (TTFB, FCP, LCP, TBT, CLS)
- Инструкции по измерению Web Vitals через Chrome DevTools и Lighthouse CLI

### Changed
- Исправлены все предыдущие версии в CHANGELOG согласно новому правилу
- Секция "Технологии" теперь содержит только изменения, а не весь стек
- Полный стек технологий перенесен в README.md
- Скрипты тестирования перенесены из `scripts/` в `tests/`
- Вся документация перенесена в папку `docs/`
- Обновлены все ссылки на документацию во всех файлах

### Fixed
- Убрано дублирование полного списка технологий в каждой версии CHANGELOG

## [0.0.7] - 2025-12-12

### Added
- Динамические URL профилей пользователей в формате /id{номер}
- Страница профиля пользователя доступна по адресу /id1, /id2 и т.д.
- Возможность просматривать профили других пользователей
- Определение "свой/чужой" профиль для отображения кнопок редактирования
- Кликабельные имена пользователей в постах с переходом на их профиль
- Динамическая ссылка "Профиль" в боковом меню (ведет на /id{userId})
- Динамическая ссылка "Управление аккаунтом" в меню пользователя

### Changed
- Страница /profile теперь редиректит на /id{userId} текущего пользователя
- Sidebar использует AuthContext для получения ID текущего пользователя
- Кнопки редактирования профиля показываются только владельцу
- Кнопка "Добавить питомца" показывается только владельцу профиля

### Технологии
- Next.js Dynamic Routes ([userId])

## [0.0.6] - 2025-12-12

### Added
- Полная интеграция профиля с базой данных
- Расширенная модель пользователя: bio, phone, location, avatar, cover_photo
- Таблица posts для хранения публикаций пользователей
- Таблица pets для хранения питомцев пользователей
- API endpoint PUT /api/profile для обновления профиля
- API endpoints для постов: GET /api/posts, POST /api/posts, PUT /api/posts/:id, DELETE /api/posts/:id
- API endpoint GET /api/posts/user/:id для получения постов пользователя
- API endpoints для питомцев: GET /api/pets/user/:id, POST /api/pets, DELETE /api/pets/:id
- Модели Post и Pet в backend
- Handlers для profile, posts, pets
- Реальное создание постов через форму CreatePost
- Отображение реальных постов в ленте из базы данных
- Отображение реальных постов и питомцев в профиле
- Форматирование времени публикации (только что, X мин назад, X ч назад)
- Загрузка данных пользователя при входе (bio, phone, location, avatar, cover_photo)
- Аватар пользователя в CreatePost и PostCard
- Защита endpoints постов и питомцев через JWT middleware

### Changed
- Модель User расширена новыми полями
- AuthContext теперь возвращает полные данные пользователя
- Endpoint /api/auth/me возвращает все поля пользователя
- Feed компонент использует реальные данные из API
- PostCard компонент адаптирован под реальную структуру Post
- Profile page отображает реальные данные из базы
- CreatePost компонент создает реальные посты в базе данных

### Fixed
- Исправлена структура ответов API (единый формат с success/data/error)
- Добавлены helper функции sendSuccessResponse и sendErrorResponse

## [0.0.5] - 2025-12-12

### Added
- Интеграция DaData API для поиска организаций по ИНН, ОГРН и названию
- Компонент OrganizationSearch с автодополнением
- Страница "Организации" с детальной информацией
- Отображение реквизитов организации (ИНН, ОГРН, КПП)
- Полная информация об адресе (индекс, регион, город, улица, дом)
- Координаты организации (geo_lat, geo_lon) из DaData
- Контактная информация (телефоны, email)
- Информация о руководстве организации
- Статус организации (Действующая/Ликвидирована)
- Дата регистрации и организационно-правовая форма
- Интеграция Яндекс.Карт для отображения местоположения организаций
- Компонент YandexMap с поддержкой геокодирования адресов
- Геокодирование через Яндекс.Карты API для точного определения координат
- Fallback на координаты из DaData при ошибке геокодирования
- Красная метка на карте с информацией об организации
- Элементы управления картой (zoom, fullscreen)
- Balloon с названием организации и адресом при клике на метку
- Файл API_KEYS.md для хранения всех API ключей проекта
- API_KEYS.md добавлен в .gitignore для безопасности

### Changed
- Определение города через DaData API вместо ip-api.com
- Карта использует геокодирование по адресу как основной метод
- Координаты из DaData используются как запасной вариант
- Высота карты установлена на 400px
- Цвет спиннера загрузки карты изменен на #1B76FF (цвет логотипа)

### Fixed
- Исправлена проблема с загрузкой карты (карта всегда в DOM)
- Убраны отладочные console.log из компонента организаций
- Исправлена ошибка геокодирования через HTTP API
- Улучшена обработка ошибок при загрузке карты
- Исправлена ошибка 413 при поиске организаций (убран фильтр status)

### Технологии
- Добавлено: DaData API (Party, Address) для поиска организаций
- Добавлено: Yandex Maps API 2.1 для отображения карт

## [0.0.4] - 2025-12-12

### Added
- Автоматическое определение города пользователя по IP (ipapi.co, ip-api.com)
- Компонент CityDetector с поддержкой русского языка
- Возможность ручного изменения города
- Умная лента с объединением постов и объявлений
- Типы постов: обычный пост, объявление, потерялся, нашелся, помощь
- Компонент выбора типа поста при создании
- Фильтры ленты в правой колонке (Все, Посты, Объявления, Потеряшки, Найдены, Помощь)
- Цветные бейджи для разных типов постов
- Динамические плейсхолдеры в зависимости от типа поста
- Favicon с логотипом ЗооПлатформы

### Changed
- Название сайта изменено на "ЗооПлатформа"
- Логотип обновлен (favicon.svg с сердечком и мордой собаки)
- Все синие цвета кнопок заменены на #1B76FF (цвет из логотипа)
- Красный цвет уведомлений изменен на #FC2B2B (цвет из логотипа)
- Убран пункт "Главная" из меню (дублировал "Ленту")
- Убран пункт "Объявления" из меню (интегрировано в ленту)
- Шрифт сайта: -apple-system, BlinkMacSystemFont, Roboto
- Ширина сайта уменьшена до 1150px (стиль VK)
- Боковое меню уменьшено до 180px
- Размер шрифта логотипа: text-sm с uppercase
- Фон поиска в хедере соответствует фону сайта (градиент)
- Уменьшен размер круга уведомлений (w-4 h-4)
- Уплотнены дополнительные пункты меню (py-1)
- Бейдж мессенджера остался овальным (px-2 py-0.5)
- Фильтры перенесены из центральной колонки в правую панель

### Fixed
- Исправлена ошибка с серверными компонентами (добавлен 'use client' в RightPanel)
- Улучшена поддержка русских названий городов
- Добавлен словарь перевода популярных городов России

## [0.0.3] - 2025-12-11

### Added
- Heroicons библиотека для иконок
- Минималистичный дизайн UI в стиле ЗооПлатформа
- Боковое меню с иконками Heroicons
- Разделители между секциями меню
- Badge для мессенджера (43 непрочитанных)
- Обновленный хедер с поиском и уведомлениями

### Changed
- Полностью переработан дизайн интерфейса
- Sidebar: чистый минималистичный стиль без фоновых подложек
- Hover эффекты с закругленными углами
- Header: выровнен с контентом страницы
- Логотип в хедере выровнен с боковым меню
- Layout: центральная колонка 580px, правая панель расширена
- Меню включает: Главная, Лента, Объявления, Профиль, Мессенджер, Зоожурнал, Афиша, Организации, Зоомаркет, Учебный центр, Сервисы, Мои питомцы, Горячая линия
- Дополнительные ссылки: О платформе, Фонд "ЗооПомощь", Статистика, Техподдержка, Команда

### Технологии
- Добавлено: Heroicons 2.x для иконок

## [0.0.2] - 2025-12-11

### Added
- React Native мобильное приложение (Expo)
- Папка `shared/` для общей логики между платформами
- Air для hot reload Go бекенда
- Metro config для React Native
- Пример интеграции mobile с backend API
- SQLite база данных
- Отдельный модуль `database/` для работы с БД
- Таблица `users` с полем password
- Автоматическая инициализация БД при старте сервера
- REST API структура (handlers, models)
- JWT авторизация
- Endpoints для регистрации и входа (`/api/auth/register`, `/api/auth/login`)
- Middleware для защиты endpoints
- Bcrypt хеширование паролей
- CRUD endpoints для users (GET, POST, PUT, DELETE)
- TypeScript типы для всех API запросов/ответов
- Стандартный формат ответов API (success, data, error)
- Документация структуры проекта (STRUCTURE.md)

### Changed
- CORS настроен на `*` для поддержки всех клиентов
- CORS headers включают Authorization
- Скрипт `run` теперь запускает три сервиса (backend, web, mobile)
- API клиент вынесен в shared (для web) и продублирован в mobile
- Обновлен Go до версии 1.25.5
- База данных вынесена в отдельный модуль в корне проекта
- Endpoints `/api/users` теперь защищены JWT токеном

### Технологии
- Добавлено: React Native 0.81.5 + Expo 54.0.27 для мобильного приложения
- Добавлено: Air 1.63.4 для hot reload Go бекенда
- Добавлено: SQLite 3 для базы данных
- Добавлено: JWT (golang-jwt/jwt/v5) для авторизации
- Добавлено: Bcrypt для хеширования паролей

## [0.0.1] - 2025-12-11

### Added
- Инициализация проекта с Go backend и Next.js frontend
- Go HTTP сервер на порту 8080 с базовыми эндпоинтами (/, /api/health)
- CORS middleware для взаимодействия с фронтендом
- Next.js приложение с TypeScript на порту 3000
- Tailwind CSS для стилизации
- Структура компонентов: ui/, shared/, layout/
- API клиент (`lib/api.ts`) для связи с бекендом
- Базовые компоненты: Button с вариантами, Header
- Environment variables конфигурация (.env.local)
- Скрипт `run` для запуска проекта с автоматической очисткой портов
- Документация: README.md и CHANGELOG.md
- Git репозиторий с тегом v0.0.1

### Технологии
- Go 1.25.5
- Node.js 25.2.0
- Next.js 16.0.8 (App Router)
- React 19.2.1
- TypeScript 5.x
- Tailwind CSS 4.x
