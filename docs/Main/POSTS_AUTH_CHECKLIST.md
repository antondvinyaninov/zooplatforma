# Checklist: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 3 —Ñ–µ–≤—Ä–∞–ª—è 2026  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ

## Endpoints –ø–æ—Å—Ç–æ–≤

### `/api/posts` - –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π (–º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- ‚úÖ **POST** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`protectedRoute`)

### `/api/posts/{id}` - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø–æ—Å—Ç
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π (–º–æ–∂–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- ‚úÖ **PUT** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)
- ‚úÖ **DELETE** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)

### `/api/posts/user/{id}` - –ü–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π

### `/api/posts/pet/{id}` - –ü–æ—Å—Ç—ã –ø–∏—Ç–æ–º—Ü–∞
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π

### `/api/posts/organization/{id}` - –ü–æ—Å—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π

### `/api/posts/drafts` - –ß–µ—Ä–Ω–æ–≤–∏–∫–∏
- ‚úÖ **GET** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`protectedRoute`)

### `/api/posts/{id}/like` - –õ–∞–π–∫–∏
- ‚úÖ **GET** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`OptionalAuthMiddleware`)
- ‚úÖ **POST** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)

### `/api/posts/{id}/likers` - –°–ø–∏—Å–æ–∫ –ª–∞–π–∫–Ω—É–≤—à–∏—Ö
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π

## Endpoints –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

### `/api/comments/post/{id}` - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç—É
- ‚úÖ **GET** - –ø—É–±–ª–∏—á–Ω—ã–π
- ‚úÖ **POST** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)

### `/api/comments/{id}` - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
- ‚úÖ **DELETE** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)

## Endpoints –æ–ø—Ä–æ—Å–æ–≤

### `/api/polls/{id}` - –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
- ‚úÖ **POST** - —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`DevAuthMiddleware`)

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### Production (—Å Gateway)
```
Frontend ‚Üí Gateway ‚Üí Main Backend
           ‚Üì
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT
    –î–æ–±–∞–≤–ª—è–µ—Ç X-User-ID
           ‚Üì
    Main Backend —á–∏—Ç–∞–µ—Ç –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
```

### Development (–±–µ–∑ Gateway)
```
Frontend ‚Üí Main Backend
           ‚Üì
    DevAuthMiddleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie
    –î–æ–±–∞–≤–ª—è–µ—Ç userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
           ‚Üì
    Handler —á–∏—Ç–∞–µ—Ç –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
```

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `GetUserIDFromGateway`

```go
func GetUserIDFromGateway(r *http.Request) (int, bool) {
    // 1. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (dev —Ä–µ–∂–∏–º)
    if userID, ok := r.Context().Value("userID").(int); ok && userID > 0 {
        return userID, true
    }
    
    // 2. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ (production)
    userIDStr := r.Header.Get("X-User-ID")
    if userIDStr == "" {
        return 0, false
    }
    
    userID, err := strconv.Atoi(userIDStr)
    if err != nil {
        return 0, false
    }
    
    return userID, true
}
```

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö!

## Middleware

### `protectedRoute`
```go
func protectedRoute(handler http.HandlerFunc) http.HandlerFunc {
    return enableCORS(middleware.DevAuthMiddleware(handler))
}
```
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç CORS
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç DevAuthMiddleware (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie, –¥–æ–±–∞–≤–ª—è–µ—Ç userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è endpoints –∫–æ—Ç–æ—Ä—ã–µ –í–°–ï–ì–î–ê —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### `DevAuthMiddleware`
```go
func DevAuthMiddleware(next http.HandlerFunc) http.HandlerFunc {
    // –ß–∏—Ç–∞–µ—Ç cookie auth_token
    // –ü–∞—Ä—Å–∏—Ç JWT
    // –î–æ–±–∞–≤–ª—è–µ—Ç userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
}
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)

### `OptionalAuthMiddleware`
```go
func OptionalAuthMiddleware(next http.HandlerFunc) http.HandlerFunc {
    // –ß–∏—Ç–∞–µ—Ç cookie auth_token –µ—Å–ª–∏ –µ—Å—Ç—å
    // –î–æ–±–∞–≤–ª—è–µ—Ç userID –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
}
```
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è endpoints –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ-—Ä–∞–∑–Ω–æ–º—É –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–∏–º–µ—Ä: GET `/api/posts/{id}/like` - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∞–π–∫–Ω—É–ª –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

## Handlers - –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å userID

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```go
func createPost(w http.ResponseWriter, r *http.Request) {
    userID, ok := r.Context().Value("userID").(int)
    if !ok || userID == 0 {
        sendErrorResponse(w, "–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω", http.StatusUnauthorized)
        return
    }
    // ...
}
```

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```go
func getAllPosts(w http.ResponseWriter, r *http.Request) {
    // –†–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö (dev –∏ production)
    userID, _ := GetUserIDFromGateway(r)
    // userID –º–æ–∂–µ—Ç –±—ã—Ç—å 0 –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
    // ...
}
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
```bash
# –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 401
curl -X POST http://localhost:8000/api/posts \
  -H "Content-Type: application/json" \
  -d '{"content":"Test"}'

# –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
curl -X POST http://localhost:8000/api/posts \
  -H "Content-Type: application/json" \
  -H "Cookie: auth_token=..." \
  -d '{"content":"Test"}'
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–µ–Ω—Ç—ã (–ø—É–±–ª–∏—á–Ω—ã–π)
```bash
# –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
curl http://localhost:8000/api/posts
```

### –¢–µ—Å—Ç 3: –õ–∞–π–∫ (—Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é)
```bash
# –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ 401
curl -X POST http://localhost:8000/api/posts/1/like

# –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å
curl -X POST http://localhost:8000/api/posts/1/like \
  -H "Cookie: auth_token=..."
```

### –¢–µ—Å—Ç 4: –°—Ç–∞—Ç—É—Å –ª–∞–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
```bash
# –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å (liked=false)
curl http://localhost:8000/api/posts/1/like

# –° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å (liked=true/false)
curl http://localhost:8000/api/posts/1/like \
  -H "Cookie: auth_token=..."
```

## –ò—Ç–æ–≥

‚úÖ –í—Å–µ endpoints –ø–æ—Å—Ç–æ–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
- –ü—É–±–ª–∏—á–Ω—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `GetUserIDFromGateway` —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ dev –∏ production

üöÄ –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!
