version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:16-alpine
    container_name: zooplatforma_db
    environment:
      POSTGRES_USER: postgres_zp
      POSTGRES_PASSWORD: 7da0905cd3349f58f368
      POSTGRES_DB: bd_zp
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres_zp"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Auth Service
  auth:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_auth
    environment:
      SERVICE: auth
      DATABASE_PATH: /app/auth.db
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "7100:7100"
    volumes:
      - ./auth/backend/auth.db:/app/auth.db
    depends_on:
      - postgres

  # Main Service (Backend + Frontend)
  main:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_main
    environment:
      SERVICE: main
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
      NEXT_PUBLIC_API_URL: http://localhost:8000
      NEXT_PUBLIC_AUTH_URL: http://localhost:7100
    ports:
      - "3000:3000"
      - "8000:8000"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started
    volumes:
      - ./database/data.db:/app/database/data.db

  # Admin Service (Backend only for now)
  admin:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_admin
    environment:
      SERVICE: admin
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "9000:9000"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

  # PetBase Service (Backend only for now)
  petbase:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_petbase
    environment:
      SERVICE: petbase
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "8100:8100"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

  # Shelter Service (Backend only for now)
  shelter:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_shelter
    environment:
      SERVICE: shelter
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "8200:8200"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

  # Owner Service (Backend only for now)
  owner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_owner
    environment:
      SERVICE: owner
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "8400:8400"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

  # Volunteer Service (Backend only for now)
  volunteer:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_volunteer
    environment:
      SERVICE: volunteer
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "8500:8500"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

  # Clinic Service (Backend only for now)
  clinic:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: zooplatforma_clinic
    environment:
      SERVICE: clinic
      DATABASE_URL: postgres://postgres_zp:7da0905cd3349f58f368@postgres:5432/bd_zp?sslmode=disable
      AUTH_SERVICE_URL: http://auth:7100
      JWT_SECRET: your-super-secret-key-change-this-in-production
      ENVIRONMENT: development
      LOG_LEVEL: info
    ports:
      - "8600:8600"
    depends_on:
      postgres:
        condition: service_healthy
      auth:
        condition: service_started

volumes:
  postgres_data:

networks:
  default:
    name: zooplatforma_network
