# üîê Auth Flow Status

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û:

1. **pkg/middleware/auth.go** - –∏–∑–º–µ–Ω–µ–Ω—ã context keys –Ω–∞ —Å—Ç—Ä–æ–∫–∏ (–±—ã–ª–æ `type contextKey string`, —Å—Ç–∞–ª–æ `const UserIDKey = "userID"`)
2. **main/frontend/lib/api.ts** - `getAuthToken()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π `fetch` –≤–º–µ—Å—Ç–æ `authClient` (–∏–∑–±–µ–≥–∞–µ–º —Ü–∏–∫–ª–∞)
3. **main/backend/handlers/likes.go** - GET –ø—Ä–∏–Ω–∏–º–∞–µ—Ç userID=0 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
4. **main/backend/main.go** - GET `/api/posts/{id}/like` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `OptionalAuthMiddleware`

## üéØ –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï:

### ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
- `/api/posts/{id}/like` (GET) - 200 OK
- –õ–∞–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (liked=false, count=X)

### ‚ùå –í—Å—ë –µ—â—ë 401:
- `/api/messages/unread` - 401 Unauthorized
- `/api/friends/requests` - 401 Unauthorized  
- `/api/notifications/unread` - 401 Unauthorized
- `/api/organizations/my` - 401 Unauthorized
- `/api/friends` - 401 Unauthorized

## üîç –ü–†–ò–ß–ò–ù–ê:

**–ë—Ä–∞—É–∑–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –°–¢–ê–†–´–ô –∫–æ–¥ `api.ts`!**

–ù–æ–≤—ã–π –∫–æ–¥ —É–∂–µ –≤ —Ñ–∞–π–ª–µ:
```typescript
private async getAuthToken(): Promise<string | null> {
  // –í–ê–ñ–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π fetch, –∞ –ù–ï authClient!
  const response = await fetch(`${AUTH_URL}/api/auth/me`, {
    credentials: 'include',
  });
  // ...
}
```

–ù–æ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª JavaScript bundle.

## üöÄ –†–ï–®–ï–ù–ò–ï:

**–û–ë–ù–û–í–ò –ë–†–ê–£–ó–ï–† (Cmd+Shift+R –∏–ª–∏ Ctrl+Shift+R)** —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥!

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
1. `ApiClient.getHeaders()` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π `getAuthToken()`
2. `getAuthToken()` –ø–æ–ª—É—á–∏—Ç —Ç–æ–∫–µ–Ω –æ—Ç Auth Service —á–µ—Ä–µ–∑ `/api/auth/me`
3. –¢–æ–∫–µ–Ω –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer {token}`
4. Main Backend –ø–æ–ª—É—á–∏—Ç —Ç–æ–∫–µ–Ω –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç —á–µ—Ä–µ–∑ `pkg/middleware.AuthMiddleware`
5. –í—Å–µ 401 –æ—à–∏–±–∫–∏ –∏—Å—á–µ–∑–Ω—É—Ç ‚úÖ

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

–û—Ç–∫—Ä–æ–π –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å:
- Network tab ‚Üí `/api/friends` ‚Üí Request Headers ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `Authorization: Bearer ...`
- Network tab ‚Üí `/api/notifications/unread` ‚Üí Request Headers ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `Authorization: Bearer ...`
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å 200 OK –≤–º–µ—Å—Ç–æ 401

## üîß –ï—Å–ª–∏ –≤—Å—ë –µ—â—ë 401 –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

1. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –≤ `getAuthToken()`
2. –ü—Ä–æ–≤–µ—Ä—å Network tab ‚Üí `/api/auth/me` ‚Üí –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å `{"success":true,"data":{"token":"..."}}`
3. –ü—Ä–æ–≤–µ—Ä—å Main Backend –ª–æ–≥–∏: `tail -f main/backend/tmp/main.log`
