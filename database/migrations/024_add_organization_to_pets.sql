-- Миграция 024: Добавление связи питомцев с организациями
-- Дата: 2025-01-12
-- Описание: Связь питомцев с приютами и клиниками (ЭТАП 0 MVP)
-- Связано с: docs/MVP.md - ЭТАП 0 - Интеграция организаций

-- ============================================
-- 1. Добавление поля organization_id
-- ============================================

-- Связь с организацией (приют, клиника)
ALTER TABLE pets ADD COLUMN organization_id INTEGER DEFAULT NULL;

-- ============================================
-- 2. Внешний ключ и индекс
-- ============================================

-- Индекс для быстрого поиска питомцев организации
CREATE INDEX IF NOT EXISTS idx_pets_organization_id ON pets(organization_id);

-- ============================================
-- 3. Комментарии к полю
-- ============================================

-- organization_id: ID организации (приют, клиника), к которой относится питомец
-- NULL - питомец не привязан к организации (частное лицо)
-- NOT NULL - питомец принадлежит организации

-- ============================================
-- 4. Примеры использования
-- ============================================

-- Найти всех питомцев приюта:
-- SELECT * FROM pets WHERE organization_id = 123;

-- Найти питомцев без организации (частные владельцы):
-- SELECT * FROM pets WHERE organization_id IS NULL;

-- Найти питомцев конкретного типа организации (например, приюты):
-- SELECT p.* FROM pets p
-- JOIN organizations o ON p.organization_id = o.id
-- WHERE o.type = 'shelter';

-- ============================================
-- 5. Проверка миграции
-- ============================================

-- Проверяем, что поле добавлено
SELECT COUNT(*) as has_organization_id 
FROM pragma_table_info('pets') 
WHERE name = 'organization_id';

-- Проверяем индекс
SELECT name FROM sqlite_master 
WHERE type='index' 
AND tbl_name='pets' 
AND name = 'idx_pets_organization_id';
