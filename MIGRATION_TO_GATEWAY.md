# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ API Gateway

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. **Gateway —Å–æ–∑–¥–∞–Ω** - `gateway/` –ø–∞–ø–∫–∞ —Å–æ –≤—Å–µ–º–∏ —Ñ–∞–π–ª–∞–º–∏
2. **Gateway –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è** - `go build` –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
3. **Dockerfile –æ–±–Ω–æ–≤–ª–µ–Ω** - Gateway —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ Docker –æ–±—Ä–∞–∑–µ
4. **start.sh –æ–±–Ω–æ–≤–ª–µ–Ω** - Gateway –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ nginx

### ‚ùå –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

## 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ Gateway

### –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

- [ ] –í—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –†–æ—É—Ç–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Middleware —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Proxy —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

## 2. –û–±–Ω–æ–≤–∏—Ç—å backend —Å–µ—Ä–≤–∏—Å—ã

### Main Backend (`main/backend/`)

**–ß—Ç–æ —É–¥–∞–ª–∏—Ç—å:**
- ‚ùå –ò–º–ø–æ—Ä—Ç `pkg/middleware` –∏–∑ handlers
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫—É JWT –≤ handlers
- ‚ùå `AuthMiddleware` –∏–∑ —Ä–æ—É—Ç–∏–Ω–≥–∞

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- ‚úÖ –ß—Ç–µ–Ω–∏–µ `X-User-ID` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- ‚úÖ –ß—Ç–µ–Ω–∏–µ `X-User-Email` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
- ‚úÖ –ß—Ç–µ–Ω–∏–µ `X-User-Role` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

**–ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

```go
// ‚ùå –ë–´–õ–û:
func GetProfile(w http.ResponseWriter, r *http.Request) {
    userID, ok := r.Context().Value(middleware.UserIDKey).(int)
    if !ok {
        sendError(w, "Unauthorized", http.StatusUnauthorized)
        return
    }
    // ...
}

// ‚úÖ –°–¢–ê–õ–û:
func GetProfile(w http.ResponseWriter, r *http.Request) {
    userIDStr := r.Header.Get("X-User-ID")
    if userIDStr == "" {
        sendError(w, "Unauthorized", http.StatusUnauthorized)
        return
    }
    userID, _ := strconv.Atoi(userIDStr)
    // ...
}
```

### PetBase Backend (`petbase/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend.

### Clinic Backend (`clinic/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend.

### Owner Backend (`owner/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend.

### Shelter Backend (`shelter/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend.

### Volunteer Backend (`volunteer/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend.

### Admin Backend (`admin/backend/`)

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Main Backend + –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ admin.

## 3. –£–¥–∞–ª–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

### –§–∞–π–ª—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:

- ‚ùå `nginx.conf` - –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
- ‚ùå `pkg/middleware/auth.go` - –ª–æ–≥–∏–∫–∞ –≤ Gateway
- ‚ùå `pkg/middleware/go.mod` - –Ω–µ –Ω—É–∂–µ–Ω

### –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –û–°–¢–ê–Æ–¢–°–Ø:

- ‚úÖ `auth/` - Auth Service (–æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)
- ‚úÖ `pkg/clients/` - –∫–ª–∏–µ–Ω—Ç—ã –¥–ª—è –æ–±—â–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

## 4. –û–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–æ–±–∞–≤–∏—Ç—å –≤ production:

```bash
# Gateway
JWT_SECRET=your-secret-key
GATEWAY_PORT=80

# Backend Services URLs (–¥–ª—è Gateway)
AUTH_SERVICE_URL=http://localhost:7100
MAIN_SERVICE_URL=http://localhost:8000
PETBASE_SERVICE_URL=http://localhost:8100
CLINIC_SERVICE_URL=http://localhost:8600
OWNER_SERVICE_URL=http://localhost:8400
SHELTER_SERVICE_URL=http://localhost:8200
VOLUNTEER_SERVICE_URL=http://localhost:8500
ADMIN_SERVICE_URL=http://localhost:9000
```

## 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å Gateway
cd gateway
JWT_SECRET=test go run .

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Auth Service
cd auth/backend
go run .

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Main Backend
cd main/backend
go run .

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å Main Frontend
cd main/frontend
npm run dev

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
curl http://localhost/health
curl http://localhost/api/posts
```

### Production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- [ ] –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- [ ] API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Health check —Ä–∞–±–æ—Ç–∞–µ—Ç

## 6. –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫)

### –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
# 1. –í–µ—Ä–Ω—É—Ç—å nginx.conf
git checkout HEAD~1 nginx.conf

# 2. –í–µ—Ä–Ω—É—Ç—å Dockerfile
git checkout HEAD~1 Dockerfile

# 3. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é
git push origin main --force
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - JWT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
2. ‚úÖ **–ú–µ–Ω—å—à–µ –∫–æ–¥–∞** - backend —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç JWT
3. ‚úÖ **Rate limiting** - –∑–∞—â–∏—Ç–∞ –æ—Ç DDoS
4. ‚úÖ **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** - –ø—Ä–æ—â–µ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å
5. ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

## üö® –†–∏—Å–∫–∏

1. ‚ö†Ô∏è **Single point of failure** - –µ—Å–ª–∏ Gateway —É–ø–∞–¥–µ—Ç, –≤—Å—ë —É–ø–∞–¥–µ—Ç
2. ‚ö†Ô∏è **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π hop** - +1-2ms latency
3. ‚ö†Ô∏è **–ù–æ–≤—ã–π –∫–æ–¥** - –º–æ–∂–µ—Ç –±—ã—Ç—å –±–∞–≥–∏

## üìù –ß–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞:
- [x] Gateway —Å–æ–∑–¥–∞–Ω
- [x] Gateway –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è
- [x] Dockerfile –æ–±–Ω–æ–≤–ª–µ–Ω
- [ ] Backend —Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] –õ–æ–∫–∞–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

### –î–µ–ø–ª–æ–π:
- [ ] –°–æ–∑–¥–∞—Ç—å backup –ë–î
- [ ] –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ production
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ 30 –º–∏–Ω—É—Ç

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- [ ] –£–¥–∞–ª–∏—Ç—å `nginx.conf`
- [ ] –£–¥–∞–ª–∏—Ç—å `pkg/middleware/`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –û–±–Ω–æ–≤–∏—Ç—å CHANGELOG.md

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–°–Ω–∞—á–∞–ª–∞**: –û–±–Ω–æ–≤–∏—Ç—å backend —Å–µ—Ä–≤–∏—Å—ã (—É–±—Ä–∞—Ç—å middleware, –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
2. **–ü–æ—Ç–æ–º**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
3. **–ó–∞—Ç–µ–º**: –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ production
4. **–ù–∞–∫–æ–Ω–µ—Ü**: –£–¥–∞–ª–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

---

**–°—Ç–∞—Ç—É—Å**: üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ (Gateway —Å–æ–∑–¥–∞–Ω, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å backend —Å–µ—Ä–≤–∏—Å—ã)
