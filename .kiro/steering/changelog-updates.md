# Правило автоматического обновления CHANGELOG

## ⚠️ КРИТИЧЕСКОЕ ПРАВИЛО: Всегда обновляйте CHANGELOG

**При ЛЮБОМ изменении кода ОБЯЗАТЕЛЬНО добавляйте запись в секцию `[Unreleased]` файла `docs/CHANGELOG.md`!**

## Когда обновлять CHANGELOG

### ✅ ВСЕГДА добавляйте запись при:

1. **Добавлении новой функции** (любой, даже маленькой)
   - Новый компонент
   - Новая страница
   - Новый API endpoint
   - Новая таблица в БД
   - Новый UI элемент

2. **Исправлении бага** (любого)
   - Ошибка компиляции
   - Ошибка в логике
   - Проблема с отображением
   - Исправление типов

3. **Изменении существующего функционала**
   - Рефакторинг
   - Изменение UI
   - Изменение API
   - Изменение структуры БД

4. **Технических изменениях**
   - Обновление зависимостей
   - Изменение конфигурации
   - Оптимизация производительности

## Формат записи

### Структура секции [Unreleased]

```markdown
## [Unreleased]

### Added
- **Название функции/компонента**
  - Детальное описание что добавлено
  - Какие файлы созданы
  - Какие API endpoints добавлены
  - Какие таблицы БД созданы
  - Технические детали реализации

### Fixed
- **Описание проблемы**
  - Что было сломано
  - Как исправили
  - Какие файлы изменены

### Changed
- **Что изменилось**
  - Старое поведение
  - Новое поведение
  - Причина изменения

### Technical
- Технические детали
- Изменения в архитектуре
- Оптимизации
```

## Примеры ПРАВИЛЬНЫХ записей

### ✅ Хорошо - детально и информативно

```markdown
## [Unreleased]

### Added
- **Компонент FriendButton на странице профиля**
  - Кнопка "Добавить в друзья" для чужих профилей
  - Кнопка "Принять" / "Отклонить" для входящих запросов
  - Кнопка "Удалить из друзей" для существующих друзей
  - Автоматическое обновление статуса после действия
  - Файл: `main/frontend/app/components/profile/FriendButton.tsx`
  - Использует API: `POST /api/friends/send`, `POST /api/friends/accept`, `DELETE /api/friends/remove`
  - Интеграция с `friendsApi.ts`
- **Страница списка друзей `/friends`**
  - Отображение всех друзей пользователя с аватарами
  - Поиск по имени друга
  - Компонент `FriendsList` для отображения списка
  - Файл: `main/frontend/app/(main)/friends/page.tsx`
  - Файл: `main/frontend/app/components/profile/FriendsList.tsx`
- **Счётчик входящих запросов в друзья**
  - Красный badge в Header рядом с иконкой друзей
  - Автоматическое обновление при новых запросах
  - Использует хук `useFriendRequests()`
  - Файл: `main/frontend/app/components/layout/Header.tsx`

### Fixed
- **Исправлен ключ контекста в уведомлениях**
  - Проблема: уведомления не загружались из-за несоответствия ключей
  - В `AuthMiddleware` использовался `"userID"`, а в handlers `"user_id"`
  - Решение: унифицирован ключ на `"userID"` во всех методах `NotificationsHandler`
  - Файл: `main/backend/handlers/notifications.go`
- **Исправлена ошибка вложенных кнопок в NotificationsDropdown**
  - Проблема: React warning о вложенных интерактивных элементах
  - Решение: заменили `<button>` внутри `<Link>` на `<div>`
  - Файл: `main/frontend/app/components/layout/NotificationsDropdown.tsx`

### Changed
- **Фильтр организаций улучшен**
  - Добавлен флаг `autoFilterDisabled` для предотвращения автосброса
  - Исправлена проблема постоянного срабатывания автофильтра при выборе "Все регионы"
  - Теперь автофильтр срабатывает только один раз при первой загрузке
  - Файл: `main/frontend/app/(main)/org/page.tsx`

### Technical
- Роут `/api/organizations/{id}` теперь обрабатывает GET и PUT через `OrganizationHandler`
- Добавлен `AuthMiddleware` для PUT запросов к организациям
- Улучшена обработка ошибок в API организаций
```

### ❌ Плохо - слишком кратко

```markdown
## [Unreleased]

### Added
- Друзья
- Лайки
- Организации

### Fixed
- Баги
```

## Процесс работы

### 1. Перед началом работы
- Откройте `docs/CHANGELOG.md`
- Убедитесь, что секция `[Unreleased]` существует

### 2. Во время работы
- После каждого значимого изменения добавляйте запись в `[Unreleased]`
- Не ждите конца дня - добавляйте сразу
- Записывайте детали, пока они свежи в памяти

### 3. При релизе
- Все записи из `[Unreleased]` переносятся в новую версию
- Добавляется дата релиза
- Секция `[Unreleased]` очищается

## Детализация записей

### Что ОБЯЗАТЕЛЬНО указывать:

1. **Название функции/компонента** - понятное и конкретное
2. **Что именно сделано** - детальное описание
3. **Какие файлы созданы/изменены** - полные пути
4. **Какие API endpoints** - методы и пути
5. **Какие таблицы БД** - названия таблиц и полей
6. **Технические детали** - как реализовано

### Пример детализации для компонента:

```markdown
- **Компонент MembersManager для управления командой организации**
  - Список участников с аватарами, ролями и должностями
  - Модальное окно добавления участника:
    - Поиск пользователей по имени
    - Выбор роли (owner, admin, moderator, member)
    - Указание должности (текстовое поле)
  - Модальное окно редактирования:
    - Изменение роли участника
    - Изменение должности
  - Удаление участников с подтверждением
  - Цветовая индикация ролей:
    - owner - фиолетовый (#8B5CF6)
    - admin - синий (#3B82F6)
    - moderator - зелёный (#10B981)
    - member - серый (#6B7280)
  - Защита от удаления:
    - Нельзя удалить owner
    - Нельзя удалить самого себя
  - Файл: `main/frontend/app/components/organizations/MembersManager.tsx`
  - API методы:
    - `addMember(orgId, userId, role, position)` - POST /api/organizations/{id}/members
    - `updateMember(orgId, userId, role, position)` - PUT /api/organizations/{id}/members/{userId}
    - `removeMember(orgId, userId)` - DELETE /api/organizations/{id}/members/{userId}
  - Файл API: `main/frontend/lib/organizations-api.ts`
```

## Checklist перед коммитом

Перед каждым `git commit` проверьте:

- [ ] Все изменения отражены в `[Unreleased]`
- [ ] Указаны все созданные/изменённые файлы
- [ ] Указаны все новые API endpoints
- [ ] Указаны все изменения в БД
- [ ] Описание детальное и понятное
- [ ] Технические детали указаны

## Зачем это нужно

1. **История проекта** - полная картина развития
2. **Документация** - что и когда было сделано
3. **Релизы** - легко собрать информацию для релиза
4. **Команда** - все знают что изменилось
5. **Отладка** - легко найти когда появился баг

---

**Помните:** CHANGELOG - это не просто список изменений, это ПОЛНАЯ ИСТОРИЯ разработки проекта!
