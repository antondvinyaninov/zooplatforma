# Requirements Document: Универсальная стена с постами о питомцах

## Introduction

Система универсальных постов в стиле Threads, где есть единственный тип контента — **пост**. Любой пост может быть обогащён вложениями (фото, видео, карточки питомцев). 

**Ключевая концепция:** Нет отдельных сущностей "объявление", "статья", "новость приюта". Всё — это пост + вложения + метки. Пользователь всегда думает, что он просто пишет пост на стене, как в Threads.

**Главная фича:** Прикрепление карточек питомцев (PetID) к постам — это создаёт автоматическую связь между постом и историей животного.

## Glossary

- **Post** - Единственный универсальный тип контента в системе, создаваемый человеком или организацией
- **Wall** - Стена (как в Threads) — место, где отображаются все посты автора
- **Author** - Автор поста (пользователь или организация)
- **PetID** - Уникальный идентификатор питомца в системе
- **Attached_Pet** - Прикреплённый питомец к посту (ключевая фича)
- **Attachment** - Медиа-вложение к посту (фото, видео)
- **Feed** - Общая лента постов (алгоритмическая или по подпискам)
- **Tag** - Метка поста (ищет дом, потерян, найден и т.д.)
- **Pet_Profile** - Страница питомца с карточкой и всеми постами о нём
- **Curator** - Волонтёр/куратор, ответственный за питомца
- **Pet_Card** - Визуальная карточка питомца, отображаемая внутри поста

---

## Requirement 1: Создание поста в стиле Threads

**User Story:** Как пользователь, я хочу создавать посты на стене с текстом и вложениями, чтобы делиться информацией и историями о питомцах.

### Acceptance Criteria

1. WHEN пользователь нажимает "Создать пост", THE System SHALL отобразить минималистичный редактор в стиле Threads
2. WHEN пользователь вводит текст, THE System SHALL сохранять текст в реальном времени
3. WHEN редактор открыт, THE System SHALL показать иконки вложений под полем ввода
4. WHEN пользователь нажимает иконку "Фото/видео", THE System SHALL открыть диалог выбора медиафайлов
5. WHEN пользователь нажимает иконку "Питомец" (лапка), THE System SHALL открыть список его питомцев и подопечных
6. WHEN пользователь выбирает питомца, THE System SHALL добавить визуальную Pet_Card под текстом
7. WHEN пользователь публикует пост, THE System SHALL создать пост с массивом attachedPets
8. WHEN пост создан без вложений, THE System SHALL сохранить пост только с текстом (минимальный пост)
9. WHEN пользователь прикрепляет несколько питомцев, THE System SHALL отобразить все Pet_Cards под текстом
10. WHEN пользователь не заполнил ни текст, ни вложения, THE System SHALL запретить публикацию

---

## Requirement 2: Отображение постов в ленте

**User Story:** Как пользователь, я хочу видеть посты в общей ленте (Feed), чтобы быть в курсе событий и историй о животных.

### Acceptance Criteria

1. WHEN пользователь открывает Feed, THE System SHALL отобразить посты в хронологическом порядке
2. WHEN пост содержит attachedPets, THE System SHALL отобразить Pet_Card внутри поста
3. WHEN пользователь кликает на Pet_Card, THE System SHALL перейти на Pet_Profile
4. WHEN пользователь выбирает режим "Для вас", THE System SHALL показать посты по алгоритму (подписки + город)
5. WHEN пользователь выбирает режим "Подписки", THE System SHALL показать только посты от подписок
6. WHEN пользователь выбирает режим "Мой город", THE System SHALL фильтровать посты по геолокации автора
7. WHEN пост имеет Tag, THE System SHALL отобразить визуальный индикатор метки (цветная рамка/бейдж)
8. WHEN пост отображается, THE System SHALL показать аватар автора, имя, время публикации
9. WHEN пользователь кликает на автора, THE System SHALL перейти на Wall автора

---

## Requirement 3: Стена пользователя (Wall)

**User Story:** Как пользователь, я хочу иметь свою стену (Wall) с постами, чтобы другие могли видеть мою активность и истории.

### Acceptance Criteria

1. WHEN пользователь создаёт пост, THE System SHALL автоматически добавить пост на его Wall
2. WHEN другой пользователь открывает профиль, THE System SHALL отобразить Wall с всеми постами автора
3. WHEN пользователь открывает свой профиль, THE System SHALL показать кнопку "Создать пост" на Wall
4. WHEN посты отображаются на Wall, THE System SHALL сортировать их по дате создания (новые сверху)
5. WHEN Wall пустая, THE System SHALL показать приглашение "Создайте первый пост"
6. WHEN пост удаляется, THE System SHALL удалить его с Wall автора

---

## Requirement 4: Профиль питомца с постами (Pet_Profile)

**User Story:** Как пользователь, я хочу видеть все посты о конкретном питомце на его странице, чтобы следить за полной историей животного.

### Acceptance Criteria

1. WHEN пользователь открывает Pet_Profile, THE System SHALL отобразить карточку с основными данными питомца
2. WHEN на Pet_Profile есть вкладка "Посты о питомце", THE System SHALL показать все посты где attachedPets содержит этот PetID
3. WHEN пост прикреплён к питомцу (добавлен PetID в attachedPets), THE System SHALL автоматически добавить пост в ленту Pet_Profile
4. WHEN питомец удаляется из attachedPets поста, THE System SHALL удалить пост из ленты Pet_Profile
5. WHEN на Pet_Profile есть вкладка "История", THE System SHALL показать служебные события (регистрация, стерилизация, смена владельца)
6. WHEN посты на Pet_Profile отображаются, THE System SHALL сортировать их по дате (новые сверху)
7. WHEN Pet_Profile открыт, THE System SHALL показать кнопку "Создать пост о питомце" (быстрое создание с автоприкреплением)

---

## Requirement 5: Прикрепление питомцев к посту (ключевая фича)

**User Story:** Как владелец/куратор, я хочу прикреплять карточки питомцев к постам одной кнопкой, чтобы связывать истории с конкретными животными.

### Acceptance Criteria

1. WHEN пользователь нажимает иконку "Питомец" (лапка), THE System SHALL показать список его питомцев (где он владелец)
2. WHEN пользователь является Curator, THE System SHALL также показать его подопечных в списке
3. WHEN пользователь выбирает питомца из списка, THE System SHALL добавить PetID в массив attachedPets
4. WHEN пользователь выбирает питомца, THE System SHALL отобразить Pet_Card с фото, именем и кратким описанием
5. WHEN пользователь удаляет прикреплённого питомца (крестик на Pet_Card), THE System SHALL удалить PetID из attachedPets
6. WHEN пост публикуется, THE System SHALL сохранить только ссылки на PetID без дублирования данных питомца
7. WHEN Pet_Card отображается в посте, THE System SHALL загрузить актуальные данные питомца по PetID
8. WHEN данные питомца изменились, THE System SHALL отобразить обновлённые данные в Pet_Card при следующей загрузке
9. WHEN пользователь прикрепляет несколько питомцев, THE System SHALL отобразить все Pet_Cards в виде списка/сетки

---

## Requirement 6: Метки постов (Tags)

**User Story:** Как пользователь, я хочу добавлять метки к постам, чтобы обозначить тип контента и помочь другим найти нужную информацию.

### Acceptance Criteria

1. WHEN пользователь создаёт пост с attachedPets, THE System SHALL предложить выбрать Tag из списка
2. WHEN питомец имеет статус "ищет дом", THE System SHALL автоматически предложить Tag "ищет дом"
3. WHEN питомец имеет статус "потерян", THE System SHALL автоматически предложить Tag "потерян"
4. WHEN пользователь выбирает Tag "ищет дом", THE System SHALL сохранить метку и выделить пост оранжевой рамкой
5. WHEN пользователь выбирает Tag "потерян", THE System SHALL сохранить метку и выделить пост красной рамкой с приоритетом
6. WHEN пользователь выбирает Tag "найден", THE System SHALL сохранить метку и выделить пост зелёной рамкой
7. WHEN пост отображается с Tag, THE System SHALL показать цветной бейдж с названием метки
8. WHEN пользователь фильтрует Feed по Tag, THE System SHALL показать только посты с этой меткой
9. WHEN пост создан без attachedPets, THE System SHALL не предлагать метки (метки только для постов о питомцах)

---

## Requirement 7: Посты от организаций

**User Story:** Как организация (приют/клиника), я хочу создавать посты о животных на своей стене, чтобы информировать о новых поступлениях и событиях.

### Acceptance Criteria

1. WHEN организация создаёт пост, THE System SHALL отобразить тот же редактор что и для обычных пользователей
2. WHEN организация прикрепляет питомца через attachedPets, THE System SHALL добавить пост на Wall организации и в Pet_Profile питомца
3. WHEN пост от организации отображается в Feed, THE System SHALL показать логотип и название организации как автора
4. WHEN пользователь кликает на автора-организацию, THE System SHALL перейти на Wall организации
5. WHEN организация создаёт пост без attachedPets, THE System SHALL сохранить пост как обычную новость на Wall организации
6. WHEN организация является владельцем питомца, THE System SHALL показать этого питомца в списке при выборе

---

## Requirement 8: Медиа вложения (Attachments)

**User Story:** Как пользователь, я хочу прикреплять фото и видео к постам, чтобы делиться визуальным контентом о питомцах.

### Acceptance Criteria

1. WHEN пользователь нажимает иконку "Фото/видео", THE System SHALL открыть диалог выбора файлов
2. WHEN пользователь выбирает фото, THE System SHALL загрузить файл и отобразить превью в редакторе
3. WHEN пользователь выбирает несколько фото, THE System SHALL создать галерею превью
4. WHEN пользователь удаляет фото из превью, THE System SHALL удалить файл из массива attachments
5. WHEN пост публикуется с фото, THE System SHALL сохранить ссылки на файлы в массиве attachments
6. WHEN пост отображается с фото в Feed, THE System SHALL показать фото в оптимизированном размере
7. WHEN пользователь кликает на фото в посте, THE System SHALL открыть полноэкранный просмотр
8. WHEN пост содержит несколько фото, THE System SHALL отобразить их в виде сетки/галереи
9. WHEN файл превышает максимальный размер, THE System SHALL показать ошибку и запретить загрузку

---

## Requirement 9: Структура данных поста (Post_Model)

**User Story:** Как система, я должна хранить посты в универсальном формате, чтобы поддерживать все сценарии использования без создания отдельных типов контента.

### Acceptance Criteria

1. THE Post_Model SHALL содержать поле id (UUID, уникальный идентификатор)
2. THE Post_Model SHALL содержать поле author_id (UUID автора)
3. THE Post_Model SHALL содержать поле author_type (enum: "user" или "organization")
4. THE Post_Model SHALL содержать поле content (string, текст поста, может быть пустым если есть attachments)
5. THE Post_Model SHALL содержать поле attachedPets (array of UUID, массив PetID)
6. THE Post_Model SHALL содержать поле attachments (array of objects, массив медиафайлов с URL и метаданными)
7. THE Post_Model SHALL содержать поле tags (array of strings, массив меток типа "ищет дом", "потерян", "найден")
8. THE Post_Model SHALL содержать поле created_at (timestamp, дата создания)
9. THE Post_Model SHALL содержать поле updated_at (timestamp, дата последнего обновления)
10. THE Post_Model SHALL содержать поле is_deleted (boolean, мягкое удаление)
11. WHEN пост создаётся, THE System SHALL валидировать наличие хотя бы одного из полей: content, attachedPets, attachments
12. WHEN пост сохраняется, THE System SHALL автоматически установить created_at и updated_at

---

## Requirement 10: Редактирование и удаление постов

**User Story:** Как автор поста, я хочу редактировать и удалять свои посты, чтобы исправлять ошибки или удалять неактуальный контент.

### Acceptance Criteria

1. WHEN пользователь является автором поста, THE System SHALL показать меню "⋯" с опциями "Редактировать" и "Удалить"
2. WHEN пользователь нажимает "Редактировать", THE System SHALL открыть редактор с текущим содержимым поста
3. WHEN пользователь изменяет текст в редакторе, THE System SHALL сохранять изменения
4. WHEN пользователь добавляет/удаляет attachedPets при редактировании, THE System SHALL обновить массив attachedPets
5. WHEN пользователь сохраняет изменения, THE System SHALL обновить пост и установить updated_at
6. WHEN пост был отредактирован, THE System SHALL показать метку "отредактировано" под постом
7. WHEN пользователь нажимает "Удалить", THE System SHALL показать подтверждение удаления
8. WHEN пользователь подтверждает удаление, THE System SHALL установить is_deleted = true (мягкое удаление)
9. WHEN пост удалён, THE System SHALL удалить его из всех лент (Wall, Feed, Pet_Profile)
10. WHEN пользователь не является автором, THE System SHALL скрыть меню редактирования
11. WHEN пост удалён, THE System SHALL сохранить запись в БД для истории (не физическое удаление)

---

## Requirement 11: Быстрое создание поста о питомце

**User Story:** Как владелец/куратор, я хочу быстро создать пост о питомце прямо со страницы питомца, чтобы не искать его в списке при создании поста.

### Acceptance Criteria

1. WHEN пользователь находится на Pet_Profile, THE System SHALL показать кнопку "Создать пост о питомце"
2. WHEN пользователь нажимает эту кнопку, THE System SHALL открыть редактор с автоматически прикреплённым PetID
3. WHEN редактор открыт с автоприкреплённым питомцем, THE System SHALL показать Pet_Card под полем ввода
4. WHEN пользователь публикует такой пост, THE System SHALL сохранить пост с этим PetID в attachedPets
5. WHEN пользователь удаляет автоприкреплённого питомца, THE System SHALL разрешить публикацию без питомца

---

## Requirement 12: Связность данных постов

**User Story:** Как система, я должна обеспечить, чтобы один пост отображался во всех нужных местах автоматически.

### Acceptance Criteria

1. WHEN пост создан, THE System SHALL добавить его на Wall автора
2. WHEN пост создан, THE System SHALL добавить его в общий Feed
3. WHEN пост содержит attachedPets, THE System SHALL добавить его в Pet_Profile каждого прикреплённого питомца
4. WHEN пост редактируется и добавляется новый PetID, THE System SHALL автоматически добавить пост в Pet_Profile этого питомца
5. WHEN пост редактируется и удаляется PetID, THE System SHALL автоматически удалить пост из Pet_Profile этого питомца
6. WHEN пост удаляется, THE System SHALL удалить его из всех мест (Wall, Feed, все Pet_Profiles)
7. WHEN данные питомца обновляются, THE System SHALL отобразить обновлённые данные в Pet_Card при следующей загрузке поста

---

## Requirement 13: Визуальное оформление Pet_Card

**User Story:** Как пользователь, я хочу видеть красивые и информативные карточки питомцев в постах, чтобы быстро понимать о ком идёт речь.

### Acceptance Criteria

1. WHEN Pet_Card отображается в посте, THE System SHALL показать фото питомца
2. WHEN Pet_Card отображается, THE System SHALL показать имя питомца
3. WHEN Pet_Card отображается, THE System SHALL показать краткое описание (порода, возраст)
4. WHEN Pet_Card отображается, THE System SHALL показать статус питомца (если есть)
5. WHEN пользователь кликает на Pet_Card, THE System SHALL перейти на Pet_Profile
6. WHEN Pet_Card отображается в редакторе, THE System SHALL показать кнопку удаления (крестик)
7. WHEN несколько Pet_Cards в одном посте, THE System SHALL отобразить их в виде вертикального списка или горизонтальной прокрутки

---

## Requirement 14: Приоритизация постов с метками

**User Story:** Как пользователь, я хочу видеть важные посты (потерянные животные) выше в ленте, чтобы быстрее помочь.

### Acceptance Criteria

1. WHEN пост имеет Tag "потерян", THE System SHALL повысить приоритет поста в Feed
2. WHEN пост имеет Tag "потерян", THE System SHALL показать его выше обычных постов в режиме "Для вас"
3. WHEN пост имеет Tag "потерян" и автор в том же городе, THE System SHALL показать пост с максимальным приоритетом
4. WHEN пост имеет Tag "найден", THE System SHALL показать его с обычным приоритетом
5. WHEN пост имеет Tag "ищет дом", THE System SHALL показать его с повышенным приоритетом для пользователей в том же городе

---

## Special Requirements

### Parser and Serializer Requirements

**Requirement 15: Сериализация постов**

**User Story:** Как система, я должна корректно сериализовать и десериализовать посты, чтобы обеспечить целостность данных.

#### Acceptance Criteria

1. WHEN пост сохраняется в БД, THE System SHALL сериализовать массивы attachedPets, attachments и tags в JSON
2. WHEN пост загружается из БД, THE System SHALL десериализовать JSON обратно в массивы
3. THE System SHALL валидировать структуру JSON перед сохранением
4. FOR ALL валидных постов, сериализация затем десериализация SHALL вернуть эквивалентный объект (round-trip property)
5. WHEN attachments содержит объекты с URL, THE System SHALL сохранить все метаданные (размер, тип, имя файла)
