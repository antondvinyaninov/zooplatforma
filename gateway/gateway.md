# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É API Gateway

> **–í–µ—Ä—Å–∏—è:** 1.2.1  
> **–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 03.02.2026  
> **–í–µ—Ç–∫–∞:** gateway

## –ò—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π

| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|--------|------|-----------|
| 1.2.1 | 03.02.2026 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–æ—É—Ç–∏–Ω–≥: Main Backend –º–∞—Ä—à—Ä—É—Ç—ã —Ç–µ–ø–µ—Ä—å –Ω–µ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ |
| 1.2.0 | 03.02.2026 | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω CORS: Gateway —É–ø—Ä–∞–≤–ª—è–µ—Ç CORS, backend –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏. –î–æ–±–∞–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ SSO |
| 1.1.0 | 03.02.2026 | –£–±—Ä–∞–Ω Auth Service, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤—Å—Ç—Ä–æ–µ–Ω–∞ –≤ Gateway |
| 1.0.0 | - | –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è Gateway |

---

## –ß—Ç–æ —ç—Ç–æ?

API Gateway - —ç—Ç–æ –µ–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –û–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω), –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∫ –Ω—É–∂–Ω—ã–º backend —Å–µ—Ä–≤–∏—Å–∞–º.

```
Frontend ‚Üí Gateway (80) ‚Üí Main Backend (8000)
                        ‚Üí PetBase Backend (8100)
                        ‚Üí Clinic Backend (8600)
                        ‚Üí Owner Backend (8400)
                        ‚Üí Shelter Backend (8200)
                        ‚Üí Volunteer Backend (8500)
                        ‚Üí Admin Backend (9000)
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`

```bash
# JWT Secret (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
JWT_SECRET=your-super-secret-key-change-this

# Gateway
GATEWAY_PORT=80

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
DATABASE_PATH=../database/data.db

# –ò–ª–∏ PostgreSQL (–¥–ª—è production)
ENVIRONMENT=production
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=password
DATABASE_NAME=zooplatforma

# Backend Services
MAIN_SERVICE_URL=http://localhost:8000
PETBASE_SERVICE_URL=http://localhost:8100
CLINIC_SERVICE_URL=http://localhost:8600
OWNER_SERVICE_URL=http://localhost:8400
SHELTER_SERVICE_URL=http://localhost:8200
VOLUNTEER_SERVICE_URL=http://localhost:8500
ADMIN_SERVICE_URL=http://localhost:9000

# Uploads
UPLOAD_PATH=/app/uploads
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
go mod download
```

---

## üèÉ –ó–∞–ø—É—Å–∫

### Development (–ª–æ–∫–∞–ª—å–Ω–æ)

```bash
go run .
```

### Production (—Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

```bash
go build -o gateway .
./gateway
```

### Docker

```bash
docker build -t gateway .
docker run -p 80:80 --env-file .env gateway
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ Gateway –∑–∞–ø—É—â–µ–Ω

```bash
curl http://localhost/health
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "status": "healthy",
  "services": {
    "main_backend": { "healthy": true },
    "petbase_backend": { "healthy": true },
    "clinic_backend": { "healthy": true }
  }
}
```

### 2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST http://localhost/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123",
    "name": "–¢–µ—Å—Ç",
    "last_name": "–¢–µ—Å—Ç–æ–≤"
  }'
```

### 3. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

```bash
curl -X POST http://localhost/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "password": "password123"
  }'
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –æ—Ç–≤–µ—Ç–∞!

### 4. –°–¥–µ–ª–∞–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å

```bash
curl http://localhost/api/profile \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ü—É–±–ª–∏—á–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

```
Frontend ‚Üí Gateway ‚Üí Backend
```

–ü—Ä–∏–º–µ—Ä: `GET /api/posts` (–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å—Ç–æ–≤)

### 2. –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)

```
Frontend ‚Üí Gateway ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT ‚Üí –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ ‚Üí Backend
```

Gateway –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è backend:
- `X-User-ID: 123`
- `X-User-Email: user@example.com`
- `X-User-Role: user`

Backend **–ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT**, –∞ –ø—Ä–æ—Å—Ç–æ —á–∏—Ç–∞–µ—Ç `X-User-ID`!

### 3. –ê–¥–º–∏–Ω—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã

```
Frontend ‚Üí Gateway ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏ admin ‚Üí Backend
```

–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é `admin` –∏–ª–∏ `superadmin` –º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `/api/admin/*`

---

## üìù –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç Gateway:
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω, logout (–≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è)
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø–∞—Ä—Å–∏–Ω–≥
- **–î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏** `X-User-*` –¥–ª—è backend
- **Rate limiting** - 100 req/sec —Å –æ–¥–Ω–æ–≥–æ IP
- **CORS** - –¥–ª—è –≤—Å–µ—Ö frontend –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Health checks** - –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### ‚ùå –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç Gateway:
- –ù–ï —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏–∏ (stateless, —Ç–æ–ª—å–∫–æ JWT)
- –ù–ï –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–ï –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É (—Ç–æ–ª—å–∫–æ —Ä–æ—É—Ç–∏–Ω–≥)

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- JWT —Ç–æ–∫–µ–Ω—ã –∂–∏–≤—É—Ç 7 –¥–Ω–µ–π
- –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä—É—é—Ç—Å—è —Å bcrypt
- Rate limiting –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç DDoS
- Backend —Å–µ—Ä–≤–∏—Å—ã –¥–æ–≤–µ—Ä—è—é—Ç —Ç–æ–ª—å–∫–æ Gateway

---

## üåê CORS - –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CORS:

```
Frontend (localhost:3000)
    ‚Üì Request with Origin: localhost:3000
    
Gateway (CORSMiddleware)
    ‚Üì –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: Access-Control-Allow-Origin: localhost:3000
    ‚Üì –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: Access-Control-Allow-Credentials: true
    ‚Üì –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç: Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
    
Backend (NO CORS!)
    ‚Üì –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { data: ... }
    ‚Üì –ë–ï–ó CORS –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    
Gateway (ProxyHandler)
    ‚Üì –§–∏–ª—å—Ç—Ä—É–µ—Ç Access-Control-* –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç backend
    ‚Üì –û—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç Gateway
    
Frontend –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
```

### üéØ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

1. **Gateway —É–ø—Ä–∞–≤–ª—è–µ—Ç CORS** - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –≥–¥–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
2. **Backend –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS** - backend —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–Ω–∞—Ç—å –æ CORS
3. **ProxyHandler —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç CORS** - –≤—Å–µ `Access-Control-*` –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç backend –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è
4. **–û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

### ‚ö†Ô∏è –ß–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞:

```
‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
Gateway —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS ‚Üí Backend —Ç–æ–∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS
–†–µ–∑—É–ª—å—Ç–∞—Ç: Access-Control-Allow-Origin: localhost:3000, localhost:3000
–ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å!

‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
Gateway —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS ‚Üí Backend –ù–ï —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS
–†–µ–∑—É–ª—å—Ç–∞—Ç: Access-Control-Allow-Origin: localhost:3000
–í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

### üìù –ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è:

**middleware.go** - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç CORS:
```go
func CORSMiddleware(next http.Handler) http.Handler {
    // –°–ø–∏—Å–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö origins
    allowedOrigins := map[string]bool{
        "http://localhost:3000": true,
        "https://your-frontend.com": true,
    }
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏
    if allowedOrigins[origin] {
        w.Header().Set("Access-Control-Allow-Origin", origin)
        w.Header().Set("Access-Control-Allow-Credentials", "true")
    }
}
```

**proxy.go** - —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç CORS –æ—Ç backend:
```go
func ProxyHandler(service *Service) http.HandlerFunc {
    // –ö–æ–ø–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç backend
    for key, values := range resp.Header {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏!
        if strings.HasPrefix(key, "Access-Control-") {
            continue
        }
        w.Header().Add(key, value)
    }
}
```

### üîß –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ frontend:

–î–æ–±–∞–≤—å—Ç–µ URL –≤ `middleware.go`:
```go
allowedOrigins := map[string]bool{
    "http://localhost:3000": true,
    "https://new-frontend.com": true,  // ‚Üê –¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
}
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS:

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è
curl -H "Origin: http://localhost:3000" http://localhost/api/posts -v

# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ò–ù –∑–∞–≥–æ–ª–æ–≤–æ–∫:
# Access-Control-Allow-Origin: http://localhost:3000
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Gateway –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ JWT_SECRET —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
echo $JWT_SECRET

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ—Ä—Ç 80 —Å–≤–æ–±–æ–¥–µ–Ω
lsof -i :80
```

### Backend —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check
curl http://localhost/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã
curl http://localhost:8000/api/health
```

### JWT —Ç–æ–∫–µ–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ JWT_SECRET –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤–µ–∑–¥–µ
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫ (7 –¥–Ω–µ–π)
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç: Authorization: Bearer TOKEN
```

### CORS –æ—à–∏–±–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** `Access-Control-Allow-Origin` –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** Backend —Å–µ—Ä–≤–∏—Å —Ç–æ–∂–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ backend —Å–µ—Ä–≤–∏—Å–∞—Ö CORS middleware –æ—Ç–∫–ª—é—á–µ–Ω
2. Gateway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –æ—Ç backend
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–µ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è:
```bash
curl -H "Origin: http://localhost:3000" http://localhost/api/posts -v
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –û–î–ò–ù –∑–∞–≥–æ–ª–æ–≤–æ–∫ Access-Control-Allow-Origin
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ frontend:**
–î–æ–±–∞–≤—å—Ç–µ URL –≤ `middleware.go`:
```go
allowedOrigins := map[string]bool{
    "http://localhost:3000": true,
    "https://your-frontend.com": true,  // ‚Üê –¥–æ–±–∞–≤—å—Ç–µ —Å—é–¥–∞
}
```

---

## üìä –õ–æ–≥–∏

Gateway –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã:

```
üöÄ API Gateway started on port 80
üìã GET /api/posts 200 15ms 127.0.0.1
‚úÖ Authenticated: user_id=1, email=user@example.com, role=user
‚úÖ Proxied to Main Backend: GET /api/posts ‚Üí 200 (took 15ms)
‚ö†Ô∏è Rate limit exceeded: POST /api/posts from 192.168.1.1
‚ùå Invalid token: token is expired
```

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ Gateway:
- Frontend –æ–±—Ä–∞—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ `http://localhost` (Gateway)
- Gateway –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫ –Ω—É–∂–Ω–æ–º—É backend
- Backend —á–∏—Ç–∞–µ—Ç `X-User-ID` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

**–í–∞–∂–Ω–æ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ backend —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã!

---

## üîê SSO (Single Sign-On)

Gateway —Ä–µ–∞–ª–∏–∑—É–µ—Ç **SSO** –¥–ª—è –≤—Å–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ZooPlatforma.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SSO:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Gateway = SSO Provider                      ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  ‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (POST /api/auth/register)               ‚îÇ
‚îÇ  ‚Ä¢ –õ–æ–≥–∏–Ω (POST /api/auth/login)                        ‚îÇ
‚îÇ  ‚Ä¢ Logout (POST /api/auth/logout)                      ‚îÇ
‚îÇ  ‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞ (GET /api/auth/me)                 ‚îÇ
‚îÇ  ‚Ä¢ –°–æ–∑–¥–∞–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–æ–≤                                ‚îÇ
‚îÇ  ‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤                               ‚îÇ
‚îÇ                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
        –û–¥–∏–Ω —Ç–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –í–°–ï–• —Å–µ—Ä–≤–∏—Å–æ–≤:
                          ‚Üì
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ  Main    ‚îÇ  Clinic  ‚îÇ  Owner   ‚îÇ  Admin   ‚îÇ
    ‚îÇ Frontend ‚îÇ Frontend ‚îÇ Frontend ‚îÇ Frontend ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç SSO:

**1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ª–æ–≥–∏–Ω–∏—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑:**
```
User ‚Üí Main Frontend ‚Üí Gateway /api/auth/login
Gateway ‚Üí –°–æ–∑–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω (—Å—Ä–æ–∫: 7 –¥–Ω–µ–π)
Gateway ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie: auth_token
User –ø–æ–ª—É—á–∞–µ—Ç —Ç–æ–∫–µ–Ω
```

**2. –¢–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ:**
```
User ‚Üí Clinic Frontend ‚Üí Gateway /api/clinic/appointments
Gateway ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω
Gateway ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç X-User-ID: 123
Gateway ‚Üí –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∫ Clinic Backend

User ‚Üí Owner Frontend ‚Üí Gateway /api/owner/pets
Gateway ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ—Ç –∂–µ JWT —Ç–æ–∫–µ–Ω
Gateway ‚Üí –î–æ–±–∞–≤–ª—è–µ—Ç X-User-ID: 123
Gateway ‚Üí –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∫ Owner Backend
```

**3. –û–¥–∏–Ω logout –¥–ª—è –≤—Å–µ—Ö:**
```
User ‚Üí Any Frontend ‚Üí Gateway /api/auth/logout
Gateway ‚Üí –£–¥–∞–ª—è–µ—Ç cookie
User —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω –≤–µ–∑–¥–µ
```

### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SSO —á–µ—Ä–µ–∑ Gateway:

1. **–û–¥–∏–Ω –ª–æ–≥–∏–Ω –¥–ª—è –≤—Å–µ—Ö** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω —Ä–∞–∑, —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ
2. **–ï–¥–∏–Ω–∞—è –±–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ë–î
3. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - JWT –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–ª—è backend** - backend –Ω–µ –¥—É–º–∞–µ—Ç –æ–± –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å 2FA, OAuth –∏ —Ç.–¥.
6. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–µ–∑–¥–µ

### üîë JWT —Ç–æ–∫–µ–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç:

```json
{
  "user_id": 123,
  "email": "user@example.com",
  "role": "user",
  "exp": 1735689600,
  "iat": 1735084800
}
```

Backend —Å–µ—Ä–≤–∏—Å—ã –ø–æ–ª—É—á–∞—é—Ç —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
- `X-User-ID: 123`
- `X-User-Email: user@example.com`
- `X-User-Role: user`

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

- `BACKEND_RULES.md` - –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å Gateway
- `README.md` - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- `DEPLOY.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
